@model ProcurementSystem.Models.Order
@using ProcurementSystem.Models.Enums

@{
    ViewBag.Title = "Details";
}

<h2>Деталі Замовлення #@Model.Id</h2>

<div>
    <h4>Замовлення від @Model.OrderDate.ToString("dd.MM.yyyy")</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.User.Login)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.User.Login)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Description)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.Status)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.TotalAmount)
        </dt>
        <dd>
            @Model.TotalAmount.ToString("C")
        </dd>

    </dl>
</div>

<h4 class="mt-4">Позиції Замовлення</h4>
@if (Model.OrderItems.Any())
{
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Категорія</th>
                <th>Товар</th>
                <th>Постачальник</th>
                <th>Кількість</th>
                <th>Ціна за од.</th>
                <th>Сума</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td>@item.Offer.Product.Category.Name</td>
                    <td>@item.Offer.Product.Name</td>
                    <td>@item.Offer.Supplier.Name</td>
                    <td>@item.Quantity</td>
                    <td>@item.UnitPrice.ToString("C")</td>
                    <td>@item.Amount.ToString("C")</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>Позицій у замовленні немає.</p>
}


<h4 class="mt-4">Рахунки</h4>
@if (Model.Invoices.Any())
{
    var invoice = Model.Invoices.First();
    <p>
        <strong>Рахунок #@invoice.Id</strong>
        (Статус: @invoice.PaymentStatus,
        Сума: @invoice.Amount.ToString("C"),
        Оплатити до: @invoice.DueDate.ToString("dd.MM.yyyy"))

        @if (User.IsInRole("БУХГАЛТЕР") || User.IsInRole("АДМІНІСТРАТОР"))
        {
            @Html.ActionLink("Деталі Рахунку", "Details", "Invoices", new { id = invoice.Id }, new { @class = "btn btn-info btn-sm ms-2" })
        }
    </p>

}
else
{
    <p>Рахунок ще не сформовано.</p>

    if (ViewBag.CanGenerateInvoice)
    {
        using (Html.BeginForm("GenerateInvoice", "Invoices", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            <input type="hidden" name="orderId" value="@Model.Id" />
            <input type="submit" value="Сформувати Рахунок" class="btn btn-success" />
        }
    }
}


<p class="mt-4">
    @if (User.IsInRole("МЕНЕДЖЕР") || User.IsInRole("АДМІНІСТРАТОР"))
    {
        @Html.ActionLink("Редагувати", "Edit", new { id = Model.Id }) <span> | </span>
    }
    @Html.ActionLink("Повернутися до Списку", "Index")
</p>