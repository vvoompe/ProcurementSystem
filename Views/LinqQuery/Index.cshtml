@model ProcurementSystem.ViewModels.BenchmarkViewModel

@{
    ViewBag.Title = "Лабораторна робота: Паралелізм";
}

<h2>Аналіз продуктивності запитів (LINQ vs PLINQ vs TPL)</h2>

@if (TempData["Message"] != null)
{
    <div class="alert alert-info">@TempData["Message"]</div>
}

<div class="well">
    <h4>Поточний стан бази даних</h4>
    <p>Кількість продуктів у таблиці: <strong>@Model.TotalRecords</strong></p>

    <div class="btn-group">
        @using (Html.BeginForm("GenerateData", "LinqQuery", FormMethod.Post, new { style = "display:inline;" }))
        {
             <button type="submit" class="btn btn-warning" onclick="return confirm('Це може зайняти деякий час. Продовжити?')">
                 <i class="glyphicon glyphicon-plus"></i> Додати до 100,000 записів
             </button>
        }

        @using (Html.BeginForm("RunTests", "LinqQuery", FormMethod.Post, new { style = "display:inline; margin-left: 10px;" }))
        {
            <button type="submit" class="btn btn-success">
                <i class="glyphicon glyphicon-play"></i> Запустити тести порівняння
            </button>
        }
        
        @Html.ActionLink("Очистити таблицю", "ClearResults", null, new { @class = "btn btn-default" })
    </div>
</div>

@if (Model.Results != null && Model.Results.Any())
{
    <h3>Результати тестування</h3>
    <table class="table table-bordered table-striped table-hover">
        <thead>
            <tr class="info">
                <th>Технологія / Метод</th>
                <th>Малий обсяг (20 записів), мс</th>
                <th>Великий обсяг (@Model.TotalRecords записів), мс</th>
                <th>Прискорення (Large Data)</th>
            </tr>
        </thead>
        <tbody>
            @{
                // Знаходимо базовий час (послідовний) для розрахунку прискорення
                double baseTime = Model.Results.FirstOrDefault(r => r.MethodName.Contains("Послідовний"))?.TimeLargeData ?? 1;
            }

            @foreach (var res in Model.Results)
            {
                <tr>
                    <td>@res.MethodName</td>
                    <td>@res.TimeSmallData.ToString("F4")</td>
                    <td>@res.TimeLargeData.ToString("F2")</td>
                    <td>
                        @if (res.TimeLargeData > 0)
                        {
                            var speedup = baseTime / res.TimeLargeData;
                            <span class="@(speedup > 1.0 ? "text-success" : "text-danger")">
                                @speedup.ToString("F2")x
                            </span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <p class="text-muted">
        <em>* Примітка: Для малого обсягу даних паралельні обчислення зазвичай повільніші через накладні витрати на створення потоків (Overhead).</em>
    </p>
}